// Generated by CoffeeScript 1.10.0
(function() {
  var app, compile, dev, express, port, route, stylus;

  dev = !true;

  express = require("express");

  stylus = require("stylus");

  route = require("./routes");

  app = express();

  compile = function(str, path) {
    return stylus(str).set("filename", path);
  };

  app.set("views", __dirname + "/views");

  app.set("view engine", "jade");

  app.use(express.logger("dev"));

  app.use(stylus.middleware({
    src: __dirname + "/public",
    compile: compile
  }));

  app.use(express["static"](__dirname + "/public"));

  app.use(express.bodyParser());

  app.get("/", route.index);

  app.get("/api/v0.1/test/:data", route.test_api);

  app.get("/partials/:name", route.partials);

  app.use(function(req, res, next) {
    res.status(404);
    if (req.accepts("html")) {
      res.render("partials/404", {
        url: req.url,
        title: "Oh no!"
      });
      return;
    }
    if (req.accepts("json")) {
      res.send({
        error: "Not found"
      });
      return;
    }
    return res.type("txt").send("Not found");
  });

  port = dev ? 8124 : 8123;

  app.listen(process.env.PORT || port);

  console.log("Node @ http://localhost:" + port + "...\n");

}).call(this);
